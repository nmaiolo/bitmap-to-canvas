<!DOCTYPE html>
<html>
<head>
    <title>PGM Image Viewer</title>
</head>
<body>
    <canvas id="canvas"></canvas>

    <script>
        // Define the canvas element and its context
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');

        // Define the URL of the linked PGM file
        const pgmFileURL = 'mountain.ascii.pgm'; 

        // Call the function to load and render the PGM image from the linked file
        loadAndRenderPGMImage(pgmFileURL);

        async function loadAndRenderPGMImage(url) {
            try {
                const response = await fetch(url);

                if (!response.ok) {
                    console.error('Failed to fetch the PGM file');
                    return;
                }

                const pgmData = await response.text();
                renderPGMImage(pgmData);
            } catch (error) {
                console.error('Error:', error);
            }
        }

        function renderPGMImage(pgmData) {
            // Parse the PGM file data and create an ImageData object
            const textDecoder = new TextDecoder('utf-8');
            const text = textDecoder.decode(new DataView(new TextEncoder().encode(pgmData)));
            const lines = text.trim().split('\n');

            // Check if it's valid or not 
            if (lines[0] !== 'P2') {
                console.error('Invalid PGM file format');
                return;
            }

            // Grab the dimensions and w/h/max value
            const dimensions = lines[1].split(' ');
            const width = parseInt(dimensions[0]);
            const height = parseInt(dimensions[1]);
            const maxValue = parseInt(lines[2]);
            const pixels = lines.slice(3).map(Number);

            // Create an ImageData object and render it on the canvas
            const imageData = ctx.createImageData(width, height);
            const imageDataArray = imageData.data;

            for (let i = 0; i < pixels.length; i++) {
                const grayValue = pixels[i];
                const pixelIndex = i * 4;
                imageDataArray[pixelIndex] = grayValue;
                imageDataArray[pixelIndex + 1] = grayValue;
                imageDataArray[pixelIndex + 2] = grayValue;
                imageDataArray[pixelIndex + 3] = 255; // Alpha channel
            }

            canvas.width = width;
            canvas.height = height;
            ctx.putImageData(imageData, 0, 0);
        }
    </script>
</body>
</html>
